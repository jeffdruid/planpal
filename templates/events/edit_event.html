{% extends 'base.html' %}

{% block title %}Edit Event{% endblock %}

{% block content %}
<div class="container card mt-2"  id="edit-form">
    <h3 class="text-center card-header">Edit Event</h3>
    <form method="post" action="" class="event-form">
        {% csrf_token %}
        <div class="form-group">
            {% comment %} {{ form.as_p }} {% endcomment %}
            <div class="mb-3">
                {{ form.title.label_tag }} {{ form.title }}
            </div>
            <div class="mb-3">
                {{ form.description.label_tag }} {{ form.description }}
            </div>
            <div class="mb-3">
                {{ form.proposed_date.label_tag }} {{ form.proposed_date }}
            </div>
            <div class="mb-3">
                {{ form.status.label_tag }} {{ form.status }}
            </div>
        </div>
        <div class="form-group">
            <label for="location">Location:</label>
            <input type="text" id="location" name="location" value="{{ form.location.value }}" class="form-control" required>
            <a id="mapLink" href="#" target="_blank" class="btn btn-link mt-2">View on Map</a>
        </div>
        {% for field in form %}
            {% if field.errors %}
                <div class="alert alert-danger">
                    <strong>{{ field.label }}:</strong>
                    <ul class="mb-0">
                        {% for error in field.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        {% endfor %}
        <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
        <p class="text-center text-white mt-4">
            <a href="{% url 'manage_invitations' event_id=event_id %}">Manage Invitations</a>
        </p>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function initAutocomplete() {
        const locationInput = document.getElementById('location');
        const autocomplete = new google.maps.places.Autocomplete(locationInput);

        autocomplete.addListener('place_changed', function() {
            const place = autocomplete.getPlace();
            const mapLink = document.getElementById('mapLink');
            if (place.geometry) {
                const location = place.formatted_address || place.name;
                mapLink.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
                mapLink.style.display = 'inline';
            } else {
                mapLink.href = '#';
                mapLink.style.display = 'none';
            }
        });
    }

    function updateMapLink() {
        const location = document.getElementById('location').value;
        const mapLink = document.getElementById('mapLink');
        if (location) {
            mapLink.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
            mapLink.style.display = 'inline';
        } else {
            mapLink.href = '#';
            mapLink.style.display = 'none';
        }
    }

    // Load the autocomplete once the window has loaded
    window.onload = function() {
        initAutocomplete();
        updateMapLink();
    };
</script>
{% endblock %}
