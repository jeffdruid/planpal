{% extends 'base.html' %}

{% block title %}Add New Event{% endblock %}

{% block content %}
<h2 style="text-align: center; color: white;">Add New Event</h2>
<form method="post" action="" class="event-form">
    {% csrf_token %}
    <div class="form-group">
        {% comment %} {{ form.as_p }} {% endcomment %}
        {{ form.title.label_tag }} {{ form.title }}
        {{ form.description.label_tag }} {{ form.description }}
        {{ form.proposed_date.label_tag }} {{ form.proposed_date }}
        {{ form.status.label_tag }} {{ form.status }}
    </div>
    <div class="form-group">
        <label for="location">Location:</label>
        <input type="text" id="location" name="location" value="{{ form.location.value }}" required>
        <a id="mapLink" href="#" target="_blank">View on Map</a>
    </div>
    {% comment %} {% if form.non_field_errors %}
        <div class="error-message">
            <ul>
                {% for error in form.non_field_errors %}
                    <li style="font-weight: bold">{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %} {% endcomment %}
    {% for field in form %}
        {% if field.errors %}
            <div class="error-message">
                <strong>{{ field.label }}:</strong>
                <ul>
                    {% for error in field.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    {% endfor %}
    <button type="submit" class="btn-submit">Add Event</button>
</form>
{% endblock %}


{% block extra_js %}
<script>
    function initAutocomplete() {
        const locationInput = document.getElementById('location');
        const autocomplete = new google.maps.places.Autocomplete(locationInput);

        autocomplete.addListener('place_changed', function() {
            const place = autocomplete.getPlace();
            const mapLink = document.getElementById('mapLink');
            if (place.geometry) {
                const location = place.formatted_address || place.name;
                mapLink.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
                mapLink.style.display = 'inline';
            } else {
                mapLink.href = '#';
                mapLink.style.display = 'none';
            }
        });
    }

    function updateMapLink() {
        const location = document.getElementById('location').value;
        const mapLink = document.getElementById('mapLink');
        if (location) {
            mapLink.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
            mapLink.style.display = 'inline';
        } else {
            mapLink.href = '#';
            mapLink.style.display = 'none';
        }
    }

    // Load the autocomplete once the window has loaded
    window.onload = function() {
        initAutocomplete();
        updateMapLink();
    };
</script>
{% endblock %}
