{% extends 'base.html' %}

{% block title %}Event Details{% endblock %}

{% block content %}
<div class="event-details-container">
    <div class="event-details">
        <span class="status-indicator status-{{ event.status|lower }}"></span>
        <h2 style="text-align: center;">Event Details</h2>
        <p><strong>Title:</strong> {{ event.title|title }}</p>
        <p><strong>Date:</strong> {{ event.proposed_date|date:"F j, Y" }}</p>
        <p><strong>Time:</strong> {{ event.proposed_date|time:"H:i" }}</p>
        <p><strong>Description:</strong> {{ event.description|title }}</p>
        <p><strong>Location:</strong> {{ event.location|title }}</p>
        <p><strong>Status:</strong> {{ event.status|title }}</p>
        <p><strong>Created by:</strong> {{ event.created_by.username|title }}</p>
        {% if event.created_by == user %}
        <div class="event-actions">
            <a href="{% url 'edit_event' event.id %}" class="edit-btn"><i class="fas fa-edit"></i></a>
            <button class="delete-btn" data-event-id="{{ event.id }}"><i class="fas fa-trash-alt"></i></button>
        </div>
        {% endif %}
        <div class="response-buttons">
            <button class="btn accept-btn" onclick="respondToInvitation('accept')">Accept</button>
            <button class="btn deny-btn" onclick="respondToInvitation('deny')">Deny</button>
            <button class="btn maybe-btn" onclick="respondToInvitation('maybe')">Maybe</button>
        </div>
    </div>
    <div class="event-availability">
        <h3>Availability</h3>
        <ul>
            <li>John Doe: <span class="status confirmed">Available</span></li>
            <li>Jane Smith: <span class="status maybe">Maybe</span></li>
            <li>Alice Johnson: <span class="status denied">Not Available</span></li>
            <li>Bob Brown: <span class="status not-answered">Not Answered</span></li>
        </ul>
        <h3>Suggested Alternative Dates</h3>
        <ul>
            <li>John Doe: June 16, 2024 - 10:00 AM</li>
            <li>Jane Smith: June 17, 2024 - 11:00 AM</li>
            <li>Alice Johnson: June 18, 2024 - 12:00 PM</li>
        </ul>
    </div>
</div>
<div class="event-invitations">
    <h3>Invitations</h3>
    <ul>
        {% for invitation in invitations %}
        <li>
            <strong>{{ invitation.user.username }}</strong> - {{ invitation.user.email }} - <span class="status {{ invitation.status|lower }}">{{ invitation.status }}</span>
        </li>
        {% empty %}
        <li>No invitations sent.</li>
        {% endfor %}
    </ul>
    <a href="{% url 'manage_invitations' event.id %}" class="invite-btn">Manage Invitations</a>
</div>

<!-- Modal for deleting an event -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Confirm Delete</h2>
        <p>Are you sure you want to delete this event?</p>
        <form method="post" id="deleteForm">
            {% csrf_token %}
            <button type="submit" class="btn-submit">Delete</button>
            <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
        </form>
    </div>
</div>

<!-- Modal for suggesting alternate dates -->
<div id="alternateDateModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Suggest an Alternate Date</h2>
        <form id="alternateDateForm">
            <div class="form-group">
                <label for="alternate_date">Alternate Date:</label>
                <input type="date" id="alternate_date" name="alternate_date" required>
                <label for="alternate_time">Time:</label>
                <input type="time" id="alternate_time" name="alternate_time" required>
            </div>
            <button type="submit" class="btn-submit">Submit</button>
        </form>
    </div>
</div>

<script>
    var deleteModal = document.getElementById("deleteModal");
    var deleteForm = document.getElementById("deleteForm");
    var closeModalBtn = document.getElementsByClassName("close")[0];

    $(".delete-btn").click(function() {
        var eventId = $(this).data("event-id");
        deleteForm.action = "/events/" + eventId + "/delete/";
        deleteModal.style.display = "block";
    });

    closeModalBtn.onclick = function() {
        deleteModal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == deleteModal) {
            deleteModal.style.display = "none";
        }
    }

    function closeModal() {
        deleteModal.style.display = "none";
    }
</script>

{% endblock %}
